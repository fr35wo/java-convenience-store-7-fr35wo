# java-convenience-store-precourse

# 편의점 결제 시스템

## 개요

**편의점 결제 시스템**은 구매자의 할인 혜택과 재고 상황을 고려하여 최종 결제 금액을 계산하고 안내하는 프로그램입니다. 이 시스템은 상품별 가격과 수량, 프로모션 및 멤버십 할인 정책을 적용하여 정확한 결제
금액을 산출하고, 영수증을 출력합니다.

## 주요 기능

### 상품 정보 관리

- **상품의 이름, 가격, 재고 수량, 프로모션 정보**를 관리합니다.
- 파일 입출력을 통해 **초기 상품 목록과 프로모션 정보를 불러옵니다**.

### 구매 및 결제 기능

- 사용자가 구매할 상품과 수량을 입력받아 **결제 금액을 계산**합니다.
- 프로모션 및 멤버십 할인 정책을 적용하여 **최종 결제 금액을 산출**합니다.
- **재고 수량을 고려하여 구매 가능 여부**를 확인하고, 구매 시 재고를 차감합니다.

### 프로모션 할인 적용

- 지정된 기간 내에 **프로모션 할인을 적용**합니다.
- **N+1 프로모션(예: 1+1, 2+1)**을 지원합니다.
- 프로모션 재고와 일반 재고를 구분하여 관리합니다.
- 프로모션 재고와 일반 재고를 구분하여 관리하며, 프로모션이 만료된 경우 해당 재고를 일반 재고로 자동 전환하여 특별한 추가 로직 없이 일반 재고에서 차감할 수 있도록 처리합니다.

### 멤버십 할인 적용

- 멤버십 회원에게 **프로모션 미적용 금액의 30%**를 할인합니다.
- 멤버십 할인은 **최대 8,000원**까지 적용됩니다.

### 영수증 출력

- **구매 내역과 할인 정보**를 포함한 영수증을 출력합니다.
- 영수증에는 구매 상품 내역, 증정 상품 내역, 총 구매액, 행사 할인, 멤버십 할인, 최종 결제 금액이 포함됩니다.

### 재구매 기능

- 결제 후 **추가 구매 여부를 확인**하고, 재고가 업데이트된 상품 목록을 보여줍니다.

---

## 기능 목록

### 1. 상품 관리

- **상품 목록 불러오기**
    - `products.md` 파일에서 상품 정보를 읽어옵니다.
    - 상품명, 가격, 재고 수량, 프로모션 정보를 파싱하여 객체로 생성합니다.

- **프로모션 정보 불러오기**
    - `promotions.md` 파일에서 프로모션 정보를 읽어옵니다.
    - 프로모션 이름, 구매 수량, 증정 수량, 시작일, 종료일을 파싱하여 객체로 생성합니다.
    - 유효한 프로모션은 프로모션 이름, 구매 수량, 증정 수량, 시작일, 종료일 등의 정보를 파싱하여 객체로 생성하고, 기간이 만료된 경우 null로 처리합니다.

### 2. 사용자 입력 처리

- **상품 및 수량 입력받기**
    - 사용자로부터 구매할 상품명과 수량을 입력받습니다.
    - 입력 형식: `[상품명-수량],[상품명-수량]`

- **추가 프로모션 수량 확인**
    - 프로모션 적용이 가능한데 수량이 부족한 경우, **추가 수량 구매 여부를 확인**합니다.
    - 입력: `Y` 또는 `N`

- **프로모션 재고 부족 시 처리**
    - 프로모션 재고가 부족하여 일부 수량에 프로모션 적용이 불가능한 경우, **정가 구매 여부**를 확인합니다.
    - 입력: `Y` 또는 `N`

- **멤버십 할인 적용 여부 확인**
    - 멤버십 할인을 적용할지 여부를 입력받습니다.
    - 입력: `Y` 또는 `N`

- **추가 구매 여부 확인**
    - 결제 후 추가로 구매할 상품이 있는지 확인합니다.
    - 입력: `Y` 또는 `N`

### 3. 결제 및 할인 적용

- **총 구매액 계산**
    - 상품별 가격과 수량을 곱하여 **총 구매액을 계산**합니다.

- **프로모션 할인 적용**
    - 현재 날짜가 프로모션 기간 내인 경우, **해당 프로모션을 적용**합니다.
    - N+1 프로모션을 계산하여 **할인 금액을 산출**합니다.

- **멤버십 할인 적용**
    - 프로모션 적용 후 남은 금액에 대해 멤버십 할인을 적용합니다.
    - 총 할인 금액은 최대 8,000원을 넘지 않습니다.

- **최종 결제 금액 계산**
    - 총 구매액에서 행사 할인과 멤버십 할인을 차감하여 **최종 결제 금액을 계산**합니다.

### 4. 재고 관리

- **재고 수량 확인 및 차감**
    - 구매하려는 수량이 재고보다 많은지 확인합니다.
    - 결제 완료 후, 구매한 수량만큼 **재고를 차감**합니다.

- **프로모션 재고 우선 차감**
    - 프로모션 기간 중에는 **프로모션 재고를 우선적으로 차감**합니다.
    - 프로모션 재고가 부족하면 일반 재고를 사용합니다.

- **프로모션 만료 시 재고 처리**
    - 프로모션이 만료되면, 해당 상품의 프로모션 재고를 일반 재고로 전환하여 통합 관리합니다.
    - 이를 통해 일반 재고에서 자연스럽게 차감되도록 하여, 프로모션과 일반 재고 간의 재고 관리 복잡성을 줄입니다.

### 5. 예외 처리

- **잘못된 입력 형식 처리**
    - 입력 형식이 올바르지 않은 경우 예외를 발생시키고 재입력을 요청합니다.
    - 오류 메시지: `[ERROR] 올바르지 않은 형식으로 입력했습니다. 다시 입력해 주세요.`

- **존재하지 않는 상품 처리**
    - 입력한 상품명이 상품 목록에 없는 경우 예외를 발생시키고 재입력을 요청합니다.
    - 오류 메시지: `[ERROR] 존재하지 않는 상품입니다. 다시 입력해 주세요.`

- **재고 수량 초과 처리**
    - 구매 수량이 재고 수량을 초과한 경우 예외를 발생시키고 재입력을 요청합니다.
    - 오류 메시지: `[ERROR] 재고 수량을 초과하여 구매할 수 없습니다. 다시 입력해 주세요.`

- **기타 잘못된 입력 처리**
    - `Y`, `N` 이외의 입력을 받은 경우 예외를 발생시키고 재입력을 요청합니다.
    - 오류 메시지: `[ERROR] 잘못된 입력입니다. 다시 입력해 주세요.`

### 6. 출력 기능

- **상품 목록 출력**
    - 현재 보유하고 있는 상품의 이름, 가격, 재고 수량, 프로모션 정보를 출력합니다.
    - 재고가 0개인 경우 `재고 없음`으로 표시합니다.

- **영수증 출력**
    - 구매 상품 내역, 증정 상품 내역, 금액 정보를 보기 좋게 정렬하여 출력합니다.
    - 출력 항목:
        - 구매 상품 내역: 상품명, 수량, 금액
        - 증정 상품 내역: 상품명, 수량
        - 총 구매액, 행사 할인, 멤버십 할인, 내실돈

---

## 예외 상황 및 처리

- **입력 형식 오류**
    - 상품명과 수량 입력 시 형식이 올바르지 않으면 오류 메시지를 출력하고 재입력을 받습니다.

- **존재하지 않는 상품**
    - 입력한 상품명이 상품 목록에 없을 경우 오류 메시지를 출력하고 재입력을 받습니다.

- **재고 부족**
    - 구매 수량이 재고 수량보다 많으면 오류 메시지를 출력하고 재입력을 받습니다.

- **잘못된 선택 입력**
    - `Y`, `N` 이외의 입력을 받은 경우 오류 메시지를 출력하고 재입력을 받습니다.
